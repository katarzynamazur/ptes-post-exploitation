#!/bin/bash

#
# PTES 4.1.3
#
# Security services comprise the software designed to keep an attacker out of systems, and keep data safe. These include, but are not limited to network firewalls, host-based firewalls, IDS/IPS, HIDS/HIPS and anti-virus. Identifying any security services on a single targeted host gives an idea of what to expect when targeting other machines in the network. It also gives an idea of what alerts may have been triggered during the test, which can be discussed with the client during the project debrief, and may result in updates to Security Policies, UAC, SELinux, IPSec, windows security templates, or other security rulesets/configurations. 
#

exists()
{
  command -v "$1" >/dev/null 2>&1
}

print_newline()
{
    for i in {0..80}
    do
        echo -ne "\e[00;90m#"
    done
    echo "" 
}

output=$1
print_newline > $output  
###############################################################################################
if [ $# -eq 0 ]
  then
    echo "No arguments supplied"
    exit 1
fi
###############################################################################################
if exists iptables; then
    iptables1=`sudo iptables -vL -t filter`
    echo -e "\e[00;31m[-] Firewall (iptables) rules (filter table): \e[00m\n$iptables1"  >> $output 
    iptables2=`sudo iptables -vL -t nat`
    echo -e "\e[00;31m[-] Firewall (iptables) rules (nat table): \e[00m\n$iptables2"  >> $output
    iptables3=`sudo iptables -vL -t mangle`
    echo -e "\e[00;31m[-] Firewall (iptables) rules (mangle table): \e[00m\n$iptables3"  >> $output  
    iptables4=`sudo iptables -vL -t raw`
    echo -e "\e[00;31m[-] Firewall (iptables) rules (raw table): \e[00m\n$iptables4"  >> $output  
    iptables5=`sudo iptables -vL -t security`
    echo -e "\e[00;31m[-] Firewall (iptables) rules (security table): \e[00m\n$iptables5"  >> $output  
    print_newline >> $output  
else
  echo 'Your OS does not have service'
fi
###############################################################################################
# TODO
###############################################################################################
cat $output
