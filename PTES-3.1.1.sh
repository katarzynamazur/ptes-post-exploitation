#!/bin/bash

#
# PTES 3.1 
# Identify all of the network interfaces on the machine along with their IP addresses, subnet masks, and gateways. 
# By identifying the interfaces and settings, networks and services can be prioritized for targeting. 
#

exists()
{
  command -v "$1" >/dev/null 2>&1
}

print_newline()
{
    for i in {0..80}
    do
        echo -ne "\e[00;90m#"
    done
    echo "" 
}

output=$1
print_newline > $output  
###############################################################################################
if [ $# -eq 0 ]
  then
    echo "No arguments supplied"
    exit 1
fi
###############################################################################################
if exists ip; then
  nicinfo1=`/sbin/ip a 2>/dev/null`
  echo -e "\e[00;31m[-] Network and IP info:\e[00m\n$nicinfo1"  >> $output   
  print_newline >> $output  
else
  echo 'Your OS does not have ip'
fi
###############################################################################################
if exists ifconfig; then
  nicinfo2=`/sbin/ifconfig -a 2>/dev/null`
  echo -e "\e[00;31m[-] Network and IP info:\e[00m\n$nicinfo2"  >> $output  
  print_newline >> $output  
else
  echo 'Your OS does not have ifconfig'
fi
###############################################################################################
# check some interface details info
if exists nmcli; then
  nicinfo3=`nmcli device status 2>/dev/null` 
  nicinfo4=`nmcli connection show 2>/dev/null` 
  echo -e "\e[00;31m[-] Interface status:\e[00m\n$nicinfo3"  >> $output  
  print_newline >> $output  
  echo -e "\e[00;31m[-] Existing network connections:\e[00m\n$nicinfo4"  >> $output  
  print_newline >> $output  
else
  echo 'Your OS does not have nmcli'
fi
###############################################################################################
# list NICs
if exists lspci; then
  nicinfo5=`lspci | egrep -i --color 'network|ethernet|wireless|wi-fi' 2>/dev/null` 
  echo -e "\e[00;31m[-] NICs:\e[00m\n$nicinfo5"  >> $output  
  print_newline >> $output  
else
  echo 'Your OS does not have lspci'
fi
###############################################################################################
# show information about NICs
if exists ip; then
  if exists ethtool; then
    for iface in $(ip addr list | awk -F': ' '/^[0-9]/ && $2 != "lo" {print $2}')
    do
        nicinfo6=`sudo ethtool $iface 2>/dev/null` 
        nicinfo7=`sudo ethtool -i $iface 2>/dev/null` 
        echo -e "\e[00;31m[-] NIC settings:\e[00m\n$nicinfo6"  >> $output  
        echo -e "\n" >> $output
        echo -e "$nicinfo7"  >> $output  
        print_newline >> $output  
    done
  else
    echo 'Your OS does not have ip'
  fi
else
  echo 'Your OS does not have ip'
fi
###############################################################################################
cat $output

