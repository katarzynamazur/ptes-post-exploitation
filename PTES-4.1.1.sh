#!/bin/bash

#
# PTES 4.1.1
# Most systems will have applications that can run at system startup or at user logon that can provide information about the purpose of the system, software and services it interacts with. This information may reveal potential countermeasures that could be in place that may hinder further exploitation of a target network and itâ€™s systems (e.g. HIDS/HIPS, Application Whitelisting, FIM). Information that should be gathered includes:

#  -  List of the applications and their associated versions installed on the system.
#  -  List of operating system updates applied to the system.
#

exists()
{
  command -v "$1" >/dev/null 2>&1
}

print_newline()
{
    for i in {0..80}
    do
        echo -ne "\e[00;90m#"
    done
    echo "" 
}

output=$1
print_newline > $output  
###############################################################################################
if [ $# -eq 0 ]
  then
    echo "No arguments supplied"
    exit 1
fi
###############################################################################################
if exists systemctl; then
    systemctl1=`systemctl list-units --type=service`
    echo -e "\e[00;31m[-] Startup services: \e[00m\n$systemctl1"  >> $output 
    print_newline >> $output  
else
  echo 'Your OS does not have systemctl'
fi
###############################################################################################
if exists systemctl; then
    systemctl2=`systemctl list-unit-files --type=service` 
    echo -e "\e[00;31m[-] Startup services: \e[00m\n$systemctl2"  >> $output 
    print_newline >> $output  
else
  echo 'Your OS does not have systemctl'
fi
###############################################################################################
if exists systemctl; then
    systemctl3=`sudo systemctl list-unit-files --type=service --state=enabled --all`
    echo -e "\e[00;31m[-] Startup services: \e[00m\n$systemctl3"  >> $output 
    print_newline >> $output  
else
  echo 'Your OS does not have systemctl'
fi
###############################################################################################
ls1=`ls /etc/init.d`
echo -e "\e[00;31m[-] Startup services: \e[00m\n$ls1"  >> $output 
print_newline >> $output  
###############################################################################################
ls2=`ls -1 /lib/systemd/system/*.service /etc/systemd/system/*.service`
echo -e "\e[00;31m[-] Startup services: \e[00m\n$ls2"  >> $output 
print_newline >> $output  
###############################################################################################
cat $output
